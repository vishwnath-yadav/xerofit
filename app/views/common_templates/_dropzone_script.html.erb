<%=hidden_field_tag :video_max_size, @max_size_allowed%>

<script>
    $( document ).ready(function() {
      max_size = parseInt($("#video_max_size").val());
      prg = $("#progressbar");
      upload_video('dropzone');
      full_workout = "<%=params[:popup]%>";
    });

    function upload_video(id){
      size = 0;
      var myDropzone = new Dropzone("#"+id,
        {
        url: "/videos/create",
        clickable: '.upload_new_video',
        paramName: "file", // The name that will be used to transfer the file
        params: {full_workout: full_workout},
        maxFilesize: max_size, // MB
        });

      myDropzone.on("addedfile", function(file) {
        $('.upload_btn_wrap').remove();
        $('.upload_wrap.active .video_uplod_txt h2').css('text-align', 'left');
        $('.upload_wrap.active .video_uplod_icon').addClass('uploading');

        $('.upload_wrap.active  .video_uplod_icon').stop(true,true).delay( 150 ).animate({
          left: '-=100px',
          marginLeft: '0',
          marginBottom: '0',
          top: '+=61px',
        }, 600 );

        $('.upload_wrap.active  .video_uplod_txt').stop().animate({
          left: '+=58px',
          top: '-=21px',
          marginLeft: '24px',
        }, 600 );

        size = (file.size/1024/1024).toFixed(1);
        if(size > max_size){
          myDropzone.removeFile(file);
        }
        else{
          prg.parent().find('h2').text(file.name);
        }
      });

      myDropzone.on("uploadprogress", function(a, progress, size_ulpload) {
        upl = (size_ulpload/1024/1024).toFixed(1);
        prg.parent().find('p').text('Uploaded '+upl+' MB of '+size+' MB');
        prg.progressbar({
        value: progress
      });
      });

      myDropzone.on("success", function(a, response) {
        html_setups(response);
      });

      myDropzone.on("error", function(a, response) {
        if(size > max_size){
          alert("Sorry the maximum file size allowed is "+max_size+" MBs")
        }
        else{
          alert("Something went wrong. Please refresh the page and try again.")
        }
      });
    }
  </script>